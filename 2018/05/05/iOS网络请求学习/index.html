<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

    <title>iOS网络请求学习 | 繁华落尽，孤芳自赏</title>
    <meta name="author" content="betofly">
    
    <meta name="description" content="想文艺，想技术，每一个写博客的人都是孤芳自赏的人，每一个做技术的人也都想看遍繁华落尽">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="iOS网络请求学习"/>
    <meta property="og:site_name" content="BeToFly&#39;s|Blog"/>

    
    <meta property="og:image" content=""/>
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="BeToFly&#39;s|Blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/prettify-tomorrow-night-eighties.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>


<body>
    <img src="/weixin_favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

    <nav class="indigo">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">BeToFly&#39;s|Blog</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            分类
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-reading " href="/reading" >
                            <i class="fa fa-book "></i>
                            
                            读书
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-about " href="/about" >
                            <i class="fa fa-user "></i>
                            
                            关于
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            搜索
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav indigo darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="https://ws4.sinaimg.cn/large/006tNc79gy1fqrj1rshmgj30b40b4my9.jpg" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">betofly</p>
                        <p class="desc">iOS/宅</p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    首页
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    归档
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    分类
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-reading " href="/reading" >
                    <i class="fa fa-book "></i>
                    
                    读书
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-about " href="/about" >
                    <i class="fa fa-user "></i>
                    
                    关于
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    搜索
                </a>
            </li>
        
    </ul>

    <ul class="side-nav indigo darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Git/">
                    Git <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/计算机网络/">
                    计算机网络 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/iOS/">
                    iOS <span class="right">4 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/学习目标/">
                    学习目标 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/ssh/">
                    ssh <span class="right">1 篇</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">搜索</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


    <main>
        <div class="container main-container">
    <nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper indigo">
        <span class="breadcrumb">当前位置（分类目录）</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/iOS/">iOS</a>


        

        
    </div>
</nav>

<article>
    <div class="card">
        <div class="card-content">
            

            <div class="article-title">
                
    
        <h1>iOS网络请求学习</h1>
    


            </div>
            <time class="pink-link-context" datetime="2018-05-05T05:56:38.000Z"><a href="/2018/05/05/iOS网络请求学习/">2018-05-05</a></time>

            <span id="busuanzi_container_page_pv" class="read-times-container">
    <i class="fa fa-eye"></i>
    <span id="busuanzi_value_page_pv"></span>
</span>

            
    <div class="tags-row">
        
            <a href="/tags/NSURLSession/" class="chip pink lighten-1">NSURLSession</a>
        
            <a href="/tags/AFNetworking/" class="chip pink lighten-1">AFNetworking</a>
        
    </div>


            <div class="toc pink-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#前言"><span class="section table-of-contents-text">前言</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#NSURLSession"><span class="section table-of-contents-text">NSURLSession</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Request缓存策略"><span class="section table-of-contents-text">Request缓存策略</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#创建NSURLSession会话对象"><span class="section table-of-contents-text">创建NSURLSession会话对象</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#创建task对象然后执行"><span class="section table-of-contents-text">创建task对象然后执行</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#NSURLSession请求示例"><span class="section table-of-contents-text">NSURLSession请求示例</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#AFNetworking"><span class="section table-of-contents-text">AFNetworking</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#利用cocoapods导入AFNetworking"><span class="section table-of-contents-text">利用cocoapods导入AFNetworking</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#AFNetworking请求格式"><span class="section table-of-contents-text">AFNetworking请求格式</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#AFNetWorking示例"><span class="section table-of-contents-text">AFNetWorking示例</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#参考文章"><span class="section table-of-contents-text">参考文章</span></a></li></ol>
</div>


            <div class="entry pink-link-context">
                <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>目前，Apple提供的网络强求API有两种，NSURLConnection和NSURLSession，最流行的网络请求框架是AFNetWorking。在iOS9之后，Apple放弃NSURLConnection，推荐NSURLSession。所以，主要学习Apple原生API——NSURLSession和AFNetworking。网络请求都是基于http协议的，详情请看<a href="https://muyangci.com/2018/05/02/http协议学习/">HTTP协议学习</a>。</p>
<h1 id="NSURLSession"><a href="#NSURLSession" class="headerlink" title="NSURLSession"></a>NSURLSession</h1><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://www.weather.com.cn/adat/sk/101010100.html"</span>];</span><br><span class="line"><span class="comment">//创建请求对象</span></span><br><span class="line"><span class="built_in">NSMutableURLRequest</span> *request =  [<span class="built_in">NSMutableURLRequest</span> requestWithURL:url];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置请求方法</span></span><br><span class="line"><span class="comment">//[request setHTTPMethod:@"GET"];</span></span><br><span class="line"><span class="comment">// 设置请求超时时间 默认超时时间60s</span></span><br><span class="line"><span class="comment">//[request setTimeoutInterval:10.0];</span></span><br><span class="line"><span class="comment">// 设置头部参数</span></span><br><span class="line"><span class="comment">//[request addValue:@"gzip" forHTTPHeaderField:@"Content-Encoding"];</span></span><br><span class="line"><span class="comment">//或者下面这种方式 添加所有请求头信息</span></span><br><span class="line"><span class="comment">//request.allHTTPHeaderFields=@&#123;@"Content-Encoding":@"gzip"&#125;;</span></span><br><span class="line"><span class="comment">//设置缓存策略</span></span><br><span class="line"><span class="comment">//[request setCachePolicy:NSURLRequestReloadIgnoringLocalCacheData];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取会话对象</span></span><br><span class="line"><span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sharedSession];</span><br><span class="line"><span class="comment">//创建任务</span></span><br><span class="line"><span class="built_in">NSURLSessionDataTask</span> *dataTask = [session dataTaskWithRequest:request completionHandler:^(<span class="built_in">NSData</span> * _Nullable data, <span class="built_in">NSURLResponse</span> * _Nullable response, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,error.localizedDescription);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,response);</span><br><span class="line">        <span class="built_in">NSString</span> *str = [[<span class="built_in">NSString</span> alloc]initWithData:data encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">//任务开始执行</span></span><br><span class="line">[dataTask resume];</span><br></pre></td></tr></table></figure>
<h2 id="Request缓存策略"><a href="#Request缓存策略" class="headerlink" title="Request缓存策略"></a>Request缓存策略</h2><ul>
<li>NSURLRequestUseProtocolCachePolicy = 0 //默认的缓存策略， 如果缓存不存在，直接从服务端获取。如果缓存存在，会根据response中的Cache-Control字段判断下一步操作，如: Cache-Control字段为must-revalidata, 则询问服务端该数据是否有更新，无更新的话直接返回给用户缓存数据，若已更新，则请求服务端.</li>
<li>NSURLRequestReloadIgnoringLocalCacheData = 1 //忽略本地缓存数据，直接请求服务端.</li>
<li>NSURLRequestReturnCacheDataElseLoad = 2 //有缓存就使用，不管其有效性(即忽略Cache-Control字段), 无则请求服务端.</li>
<li>NSURLRequestReturnCacheDataDontLoad = 3 //只加载本地缓存. 没有就失败. (确定当前无网络时使用)</li>
<li>NSURLRequestIgnoringLocalAndRemoteCacheData = 4 //忽略本地缓存，代理服务器以及其他中介，直接请求源服务端.</li>
<li>NSURLRequestReloadRevalidatingCacheData = 5 //缓存数据必须得得到服务端确认有效才使用</li>
</ul>
<h2 id="创建NSURLSession会话对象"><a href="#创建NSURLSession会话对象" class="headerlink" title="创建NSURLSession会话对象"></a>创建NSURLSession会话对象</h2><ul>
<li><p>通过iOS共享Session方式</p>
  <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 采用苹果提供的共享session</span></span><br><span class="line">    <span class="built_in">NSURLSession</span> *sharedSession = [<span class="built_in">NSURLSession</span> sharedSession];</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过NSURLSessionConfiguration配置创建</p>
  <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造NSURLSessionConfiguration</span></span><br><span class="line">    <span class="built_in">NSURLSessionConfiguration</span> *configuration = [<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration];</span><br><span class="line">    <span class="comment">// 创建NSURLSession</span></span><br><span class="line">    <span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sessionWithConfiguration:configuration];</span><br></pre></td></tr></table></figure>
<p>  NSURLSessionConfiguration提供了三种创建NSURLSession的方式：</p>
<ol>
<li>defaultSessionConfiguration //默认配置使用的是持久化的硬盘缓存，存储证书到用户钥匙链。存储cookie到shareCookie。</li>
<li>ephemeralSessionConfiguration //不使用永久持存cookie、证书、缓存的配置，最佳优化数据传输。</li>
<li><p>backgroundSessionConfigurationWithIdentifier //可以上传下载HTTP和HTTPS的后台任务(程序在后台运行)，在后台时，将网络传输交给系统的单独的一个进程,即使app挂起、退出甚至崩溃照样在后台执行。</p>
<p>也可以通过NSURLSessionConfiguration统一设置超时时间、请求头等信息：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造NSURLSessionConfiguration</span></span><br><span class="line"><span class="built_in">NSURLSessionConfiguration</span> *configuration = [<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration];</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置请求超时为10秒钟</span></span><br><span class="line">configuration.timeoutIntervalForRequest = <span class="number">10</span>;</span><br><span class="line"><span class="comment">//在蜂窝网络情况下是否继续请求（上传或下载）</span></span><br><span class="line">configuration.allowsCellularAccess = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置请求头</span></span><br><span class="line">configuration.HTTPAdditionalHeaders =@&#123;<span class="string">@"Content-Encoding"</span>:<span class="string">@"gzip"</span>&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<h2 id="创建task对象然后执行"><a href="#创建task对象然后执行" class="headerlink" title="创建task对象然后执行"></a>创建task对象然后执行</h2><p>iOS为了适应不同的应用场景提供了不同类型的NSSessionTask：</p>
<ul>
<li>NSURLSessionDataTask  //一般的get、post等请求</li>
<li>NSURLSessionUploadTask // 用于上传文件或者数据量比较大的请求</li>
<li>NSURLSessionDownloadTask //用于下载文件或者数据量比较大的请求</li>
<li>NSURLSessionStreamTask //建立一个TCP / IP连接的主机名和端口或一个网络服务对象。</li>
</ul>
<h2 id="NSURLSession请求示例"><a href="#NSURLSession请求示例" class="headerlink" title="NSURLSession请求示例"></a>NSURLSession请求示例</h2><ul>
<li><p>一般请求</p>
  <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、创建URL资源地址</span></span><br><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://api.nohttp.net/postBody"</span>];</span><br><span class="line"><span class="comment">// 2、创建Reuest请求</span></span><br><span class="line"><span class="built_in">NSMutableURLRequest</span> *request = [<span class="built_in">NSMutableURLRequest</span> requestWithURL:url];</span><br><span class="line"><span class="comment">// 3、配置Request</span></span><br><span class="line"><span class="comment">// 设置请求超时</span></span><br><span class="line">[request setTimeoutInterval:<span class="number">10.0</span>];</span><br><span class="line"><span class="comment">// 设置请求方法</span></span><br><span class="line">[request setHTTPMethod:<span class="string">@"POST"</span>];</span><br><span class="line"><span class="comment">// 设置头部参数</span></span><br><span class="line">[request addValue:<span class="string">@"gzip"</span> forHTTPHeaderField:<span class="string">@"Content-Encoding"</span>];</span><br><span class="line"><span class="comment">// 4、构造请求参数</span></span><br><span class="line"><span class="comment">// 4.1、创建字典参数，将参数放入字典中，可防止程序员在主观意识上犯错误，即参数写错。</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *parametersDict = @&#123;<span class="string">@"name"</span>:<span class="string">@"yanzhenjie"</span>,<span class="string">@"pwd"</span>:<span class="string">@"123"</span>&#125;;</span><br><span class="line"><span class="comment">// 4.2、遍历字典，以“key=value&amp;”的方式创建参数字符串。</span></span><br><span class="line"><span class="built_in">NSMutableString</span> *parameterString = [[<span class="built_in">NSMutableString</span> alloc]init];</span><br><span class="line"><span class="keyword">int</span> pos =<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *key <span class="keyword">in</span> parametersDict.allKeys) &#123;</span><br><span class="line">    <span class="comment">// 拼接字符串</span></span><br><span class="line">    [parameterString appendFormat:<span class="string">@"%@=%@"</span>, key, parametersDict[key]];</span><br><span class="line">    <span class="keyword">if</span>(pos&lt;parametersDict.allKeys.count<span class="number">-1</span>)&#123;</span><br><span class="line">        [parameterString appendString:<span class="string">@"&amp;"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    pos++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 4.3、NSString转成NSData数据类型。</span></span><br><span class="line"><span class="built_in">NSData</span> *parametersData = [parameterString dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line"><span class="comment">// 5、设置请求报文</span></span><br><span class="line">[request setHTTPBody:parametersData];</span><br><span class="line"><span class="comment">// 6、构造NSURLSessionConfiguration</span></span><br><span class="line"><span class="built_in">NSURLSessionConfiguration</span> *configuration = [<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration];</span><br><span class="line"><span class="comment">// 7、创建网络会话</span></span><br><span class="line"><span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sessionWithConfiguration:configuration];</span><br><span class="line"><span class="comment">// 8、创建会话任务</span></span><br><span class="line"><span class="built_in">NSURLSessionDataTask</span> *task = [session dataTaskWithRequest:request completionHandler:^(<span class="built_in">NSData</span> * _Nullable data, <span class="built_in">NSURLResponse</span> * _Nullable response, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line">    <span class="comment">// 10、判断是否请求成功</span></span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"post error :%@"</span>,error.localizedDescription);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果请求成功，则解析数据。</span></span><br><span class="line">        <span class="keyword">id</span> object = [<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:data options:<span class="built_in">NSJSONReadingMutableLeaves</span> error:&amp;error];</span><br><span class="line">        <span class="comment">// 11、判断是否解析成功</span></span><br><span class="line">        <span class="keyword">if</span> (error) &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"post error :%@"</span>,error.localizedDescription);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 解析成功，处理数据，通过GCD获取主队列，在主线程中刷新界面。</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"post success :%@"</span>,object);</span><br><span class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                <span class="comment">// 刷新界面...</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// 9、执行任务</span></span><br><span class="line">[task resume];</span><br></pre></td></tr></table></figure>
</li>
<li><p>附带表单参数文件上传</p>
  <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSDate</span>* dat = [<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:<span class="number">0</span>];</span><br><span class="line"><span class="built_in">NSTimeInterval</span> a=[dat timeIntervalSince1970];</span><br><span class="line"><span class="built_in">NSString</span>* fileName = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"file_%0.f.txt"</span>, a];</span><br><span class="line"></span><br><span class="line">[FileUtils writeDataToFile:fileName data:[<span class="string">@"upload_file_to_server"</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以流的方式上传，大小理论上不受限制，但应注意时间</span></span><br><span class="line"><span class="comment">// 1、创建URL资源地址</span></span><br><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://api.nohttp.net/upload"</span>];</span><br><span class="line"><span class="comment">// 2、创建Reuest请求</span></span><br><span class="line"><span class="built_in">NSMutableURLRequest</span> *request = [<span class="built_in">NSMutableURLRequest</span> requestWithURL:url];</span><br><span class="line"><span class="comment">// 3、配置Request</span></span><br><span class="line"><span class="comment">//设置Body值方法二，这种方法比较原始，不常用，不过可以用来上传参数和文件</span></span><br><span class="line"><span class="built_in">NSString</span> *BOUNDARY = <span class="string">@"whoislcj"</span>;<span class="comment">//表单分界线 可以自定义任意值</span></span><br><span class="line">[request setValue:[<span class="string">@"multipart/form-data; boundary="</span> stringByAppendingString:BOUNDARY] forHTTPHeaderField:<span class="string">@"Content-Type"</span>];</span><br><span class="line"><span class="comment">// 文件上传使用post</span></span><br><span class="line">[request setHTTPMethod:<span class="string">@"POST"</span>];</span><br><span class="line"><span class="comment">// 设置请求超时</span></span><br><span class="line">[request setTimeoutInterval:<span class="number">30.0</span>f];</span><br><span class="line"><span class="comment">//用于存放二进制数据流</span></span><br><span class="line"><span class="built_in">NSMutableData</span> *body = [<span class="built_in">NSMutableData</span> data];</span><br><span class="line"></span><br><span class="line"><span class="comment">//追加一个普通表单参数 name=yanzhenjie</span></span><br><span class="line"><span class="built_in">NSString</span> *nameParam = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"--%@\r\nContent-Disposition: form-data; name=\"%@\"\r\n\r\n%@\r\n"</span>,BOUNDARY,<span class="string">@"name"</span>,<span class="string">@"yanzhenjie"</span>,<span class="literal">nil</span>];</span><br><span class="line">[body appendData:[nameParam dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">//追加一个普通表单参数 pwd=123</span></span><br><span class="line"><span class="built_in">NSString</span> *pwdParam = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"--%@\r\nContent-Disposition: form-data; name=\"%@\"\r\n\r\n%@\r\n"</span>,BOUNDARY,<span class="string">@"pwd"</span>,<span class="string">@"123"</span>,<span class="literal">nil</span>];</span><br><span class="line">[body appendData:[pwdParam dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">//追加一个文件表单参数</span></span><br><span class="line"><span class="comment">// Content-Disposition: form-data; name="&lt;服务器端需要知道的名字&gt;"; filename="&lt;服务器端这个传上来的文件名&gt;"</span></span><br><span class="line"><span class="comment">// Content-Type: application/octet-stream --根据不同的文件类型选择不同的值</span></span><br><span class="line"><span class="built_in">NSString</span> *file = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"--%@\r\nContent-Disposition: form-data; name=\"%@\";filename=\"%@\"\r\nContent-Type: application/octet-stream\r\n\r\n"</span>,BOUNDARY,<span class="string">@"headUrl"</span>,fileName,<span class="literal">nil</span>];</span><br><span class="line">[body appendData:[file dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line"><span class="comment">//获取file路径</span></span><br><span class="line"><span class="built_in">NSString</span> *filePath =[FileUtils getFilePath:fileName];</span><br><span class="line"><span class="built_in">NSData</span> *data =[<span class="built_in">NSData</span> dataWithContentsOfFile:filePath];</span><br><span class="line"><span class="comment">//追加文件二进制数据</span></span><br><span class="line">[body appendData:data];</span><br><span class="line">[body appendData:[<span class="string">@"\r\n"</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line"><span class="comment">//结束分割线</span></span><br><span class="line"><span class="built_in">NSString</span> *endString = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"--%@--"</span>,BOUNDARY];</span><br><span class="line">[body appendData:[endString dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建会话</span></span><br><span class="line"><span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sharedSession];</span><br><span class="line"><span class="comment">// 3.开始上传   request的body data将被忽略，而由fromData提供</span></span><br><span class="line"><span class="built_in">NSURLSessionUploadTask</span> *uploadTask= [session uploadTaskWithRequest:request fromData:body completionHandler:^(<span class="built_in">NSData</span> * _Nullable data, <span class="built_in">NSURLResponse</span> * _Nullable response, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"upload error:%@"</span>,error);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"upload success：%@"</span>, [<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:data options:<span class="built_in">NSJSONReadingMutableLeaves</span> error:&amp;error]);</span><br><span class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            <span class="comment">// 刷新界面...</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">//执行任务</span></span><br><span class="line">[uploadTask resume];</span><br></pre></td></tr></table></figure>
</li>
<li><p>文件下载</p>
  <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建url</span></span><br><span class="line"><span class="built_in">NSString</span> *urlStr =<span class="string">@"http://images2015.cnblogs.com/blog/950883/201701/950883-20170105104233581-62069155.png"</span>;</span><br><span class="line"><span class="built_in">NSURL</span> *Url = [<span class="built_in">NSURL</span> URLWithString:urlStr];</span><br><span class="line"><span class="comment">// 创建请求</span></span><br><span class="line"><span class="built_in">NSMutableURLRequest</span> *request = [<span class="built_in">NSMutableURLRequest</span> requestWithURL:Url];</span><br><span class="line"><span class="comment">// 设置请求超时</span></span><br><span class="line">[request setTimeoutInterval:<span class="number">30.0</span>];</span><br><span class="line"><span class="comment">// 创建会话</span></span><br><span class="line"><span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sharedSession];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSURLSessionDownloadTask</span> *downLoadTask = [session downloadTaskWithRequest:request completionHandler:^(<span class="built_in">NSURL</span> * _Nullable location, <span class="built_in">NSURLResponse</span> * _Nullable response, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!error) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"download sucess : %@"</span>, location);</span><br><span class="line">        <span class="built_in">NSData</span> *data=[<span class="built_in">NSData</span> dataWithContentsOfURL:location];</span><br><span class="line">        <span class="built_in">UIImage</span> *image=[<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            <span class="comment">// 刷新界面...</span></span><br><span class="line">            <span class="built_in">UIImageView</span> *imageView =[[<span class="built_in">UIImageView</span> alloc]init];</span><br><span class="line">            imageView.image=image;</span><br><span class="line">            [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">            [imageView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">                make.center.equalTo(<span class="keyword">self</span>.view);</span><br><span class="line">                make.size.mas_equalTo(<span class="built_in">CGSizeMake</span>(<span class="number">300</span>, <span class="number">300</span>));</span><br><span class="line">            &#125;];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"download error : %@"</span>, error.localizedDescription);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">//启动任务</span></span><br><span class="line">[downLoadTask resume];</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="AFNetworking"><a href="#AFNetworking" class="headerlink" title="AFNetworking"></a>AFNetworking</h1><h2 id="利用cocoapods导入AFNetworking"><a href="#利用cocoapods导入AFNetworking" class="headerlink" title="利用cocoapods导入AFNetworking"></a>利用cocoapods导入AFNetworking</h2><p>参考网络教程</p>
<h2 id="AFNetworking请求格式"><a href="#AFNetworking请求格式" class="headerlink" title="AFNetworking请求格式"></a>AFNetworking请求格式</h2><p>通过对requestSerializer的设置来区分AFNetworking数据请求的序列化格式，网络请求的序列化编码有以下三种：</p>
<ol>
<li>AFHTTPRequestSerializer：普通的HTTP编码格式，类似于“cellnumber=12344445555&amp;taken=123456”，可以直接在浏览器上访问的格式</li>
<li>AFJSONRequestSerializer：JSON的编码格式</li>
<li>AFPropertyListRequestSerializer：plist格式，一种特殊的XML格式。</li>
</ol>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</span><br><span class="line">manager = [AFHTTPRequestSerializer serializer];</span><br></pre></td></tr></table></figure>
<h2 id="AFNetWorking示例"><a href="#AFNetWorking示例" class="headerlink" title="AFNetWorking示例"></a>AFNetWorking示例</h2><ul>
<li><p>一般请求</p>
  <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">AFHTTPSessionManager *afSession = [AFHTTPSessionManager manager];    </span><br><span class="line">[afSession GET\POST:<span class="string">@"请求的url"</span> parameters:<span class="literal">nil</span> progress:^(<span class="built_in">NSProgress</span> * _Nonnull downloadProgress) &#123;</span><br><span class="line">    <span class="comment">//与下载文件有关</span></span><br><span class="line">&#125; success:^(<span class="built_in">NSURLSessionDataTask</span> * _Nonnull task, <span class="keyword">id</span>  _Nullable responseObject) &#123;</span><br><span class="line">    <span class="comment">//成功后执行</span></span><br><span class="line">&#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> * _Nonnull error) &#123;</span><br><span class="line">    <span class="comment">//失败后执行</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载文件</p>
  <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 创建NSURLSessionConfiguration</span></span><br><span class="line">    <span class="built_in">NSURLSessionConfiguration</span> *configuration = [<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration];</span><br><span class="line">    <span class="comment">//2. 创建管理者对象</span></span><br><span class="line">    AFURLSessionManager *manager = [[AFURLSessionManager alloc]initWithSessionConfiguration:configuration];</span><br><span class="line">    <span class="comment">//3. 设置url</span></span><br><span class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://127.0.0.1/1.mp4"</span>];</span><br><span class="line">    <span class="comment">//4. 创建请求对象</span></span><br><span class="line">    <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:url];    </span><br><span class="line">    <span class="comment">//5. 下载任务</span></span><br><span class="line">    <span class="built_in">NSURLSessionDownloadTask</span> *downloadTask = [manager downloadTaskWithRequest:request progress:^(<span class="built_in">NSProgress</span> * _Nonnull downloadProgress) &#123;</span><br><span class="line">        <span class="comment">//打印下载进度</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%lf"</span>,<span class="number">1.0</span>*downloadProgress.completedUnitCount/downloadProgress.totalUnitCount);       </span><br><span class="line">    &#125; destination:^<span class="built_in">NSURL</span> * _Nonnull(<span class="built_in">NSURL</span> * _Nonnull targetPath, <span class="built_in">NSURLResponse</span> * _Nonnull response) &#123;</span><br><span class="line">        <span class="comment">//设置下载路径</span></span><br><span class="line">        <span class="built_in">NSURL</span> *documentsDirectoryURL = [[<span class="built_in">NSFileManager</span> defaultManager]URLForDirectory:<span class="built_in">NSDocumentDirectory</span> inDomain:<span class="built_in">NSUserDomainMask</span> appropriateForURL:<span class="literal">nil</span> create:<span class="literal">NO</span> error:<span class="literal">nil</span>];        </span><br><span class="line">        <span class="keyword">return</span> [documentsDirectoryURL URLByAppendingPathComponent:[response suggestedFilename]];        </span><br><span class="line">    &#125; completionHandler:^(<span class="built_in">NSURLResponse</span> * _Nonnull response, <span class="built_in">NSURL</span> * _Nullable filePath, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line">        <span class="comment">//下载完成</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"File downloaded to : %@"</span>,filePath);</span><br><span class="line">    &#125;];</span><br><span class="line">    <span class="comment">//启动任务</span></span><br><span class="line">    [downloadTask resume];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>上传请求</p>
  <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建NSURLSessionConfiguration</span></span><br><span class="line">    <span class="built_in">NSURLSessionConfiguration</span> *configuration = [<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration]；</span><br><span class="line">    <span class="comment">//创建管理者对象</span></span><br><span class="line">    AFURLSessionManager *manager = [[AFURLSessionManager alloc]initWithSessionConfiguration:configuration]; </span><br><span class="line">    <span class="comment">//设置url</span></span><br><span class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://127.0.0.1"</span>];</span><br><span class="line">    <span class="comment">//创建请求对象</span></span><br><span class="line">    <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:url];</span><br><span class="line">    <span class="comment">//文件路径</span></span><br><span class="line">    <span class="built_in">NSURL</span> *filePath = [<span class="built_in">NSURL</span> fileURLWithPath:<span class="string">@"file://Users/Liu/Desktop/Note"</span>];    </span><br><span class="line">    <span class="comment">//上传任务</span></span><br><span class="line">    <span class="built_in">NSURLSessionUploadTask</span> *uploadTask = [manager uploadTaskWithRequest:request fromFile:filePath progress:<span class="literal">nil</span> completionHandler:^(<span class="built_in">NSURLResponse</span> * _Nonnull response, <span class="keyword">id</span>  _Nullable responseObject, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line">        <span class="keyword">if</span>(error)&#123;</span><br><span class="line">            <span class="comment">//错误</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"Error:%@"</span>,error);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//成功</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"Success %@ %@"</span>,response,responseObject);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    <span class="comment">//启动任务</span></span><br><span class="line">    [uploadTask resume];</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ul>
<li><a href="https://blog.csdn.net/ch_quan/article/details/54943652" target="_blank" rel="noopener">https://blog.csdn.net/ch_quan/article/details/54943652</a></li>
<li><a href="https://www.jianshu.com/p/c34f0740f178" target="_blank" rel="noopener">https://www.jianshu.com/p/c34f0740f178</a></li>
</ul>

                
<p class="pink-link-context">
    <a href="/2018/05/24/学习目标一记/" rel="next" title="学习目标一记">
    上一篇：学习目标一记
  </a>
</p>



<p class="pink-link-context">
    <a href="/2018/05/02/http协议学习/" rel="next" title="http协议学习">
    下一篇：http协议学习
  </a>
</p>


            </div>
			
        </div>
    </div>
</article>






</div>

        <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large pink">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect green" title="回到顶部"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse yellow darken-1"  data-activates="main-menu" title="菜单"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

    </main>
    <footer class="page-footer indigo darken-1">
    
    <div class="footer-container container">
        <div class="row">
            
            <div class="social-group col m4 s12">
                <h5 class="white-text">社交</h5>
                
                    <a class="social-link" href="http://weibo.com/1956184117" target="_blank">
                        <i class="fa fa-2x fa-weibo"></i>
                    </a>
                
                    <a class="social-link" href="https://github.com/raytaylorlin" target="_blank">
                        <i class="fa fa-2x fa-github"></i>
                    </a>
                
                    <a class="social-link" href="/atom.xml" target="_blank">
                        <i class="fa fa-2x fa-rss"></i>
                    </a>
                
                
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
    </script>
    <div class="site-visitors-container white-text">
        <span>
            <i class="fa fa-user"></i>
            <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
        </span>
        <span>&nbsp;|&nbsp;</span>
        <span>
            <i class="fa fa-eye"></i>
            <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
        </span>
    </div>


            </div>
            

            
            <div class="col m8 s12">
                <h5 class="white-text">友情链接</h5>
                
                    <a class="social-link" href="http://raytaylorlin.com/" target="_blank">raytaylorism主题作者的技术博客</a>
                
                    <a class="social-link" href="https://github.com/raytaylorlin" target="_blank">Github地址（测试友情链接）</a>
                
            </div>
            
        </div>
    </div>
    

    <div class="footer-copyright pink-link-context">
        <div class="container">
            © 2018 luoqinzy.com, All rights reserved.
            <p class="right" style="margin-top: 0;">本博客由 <a href="https://hexo.io">Hexo</a> 强力驱动 | 主题 <a href="https://github.com/raytaylorlin/hexo-theme-raytaylorism">raytaylorism</a></p>
        </div>
    </div>
</footer>


    <noscript>
    <div class="noscript">
        <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    (function($) {
        $(document).ready(function() {
            // 隐藏禁用javascript（针对微信内置浏览器）的提示
            $('.noscript').hide();

            // 图片缩放效果
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // 给图片加上点击放大效果（materialbox插件）
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // 优化表格的显示
            $('table').each(function() {
                var $table = $(this);
                // 除去多行代码的情况
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // 首页幻灯片
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // 针对gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // 文章目录
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();

            // 目录随屏幕滚动（防止目录过长越过footer）
            var $toc = $('.toc');
            var scrollTargetTop = 0;
            $(window).scroll(function() {
                var $activeLink = $toc.find('a.active.section');
                if ($(window).scrollTop() < 100) {
                    scrollTargetTop = 0;
                } else {
                    if ($activeLink[0]) {
                        scrollTargetTop = $activeLink.offset().top - $toc.offset().top;
                    }
                }
                $toc.css('top', '-' + scrollTargetTop + 'px');
            });

            // 修正文章目录的left-border颜色
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // 针对移动端做的优化：FAB按钮点击一下收回
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // 回到顶部
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // 重置读书页面的Tab标签页的颜色
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('pink lighten-2');

            
            // 添加new标签
            $('.menu-reading, .menu-about').append('<span class="new badge pink"></span>');
            

            // 搜索功能
            $('.modal-trigger').leanModal({
                // 打开搜索框时自动聚焦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // 初始化搜索与匹配函数
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" async
  src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



</body>
</html>
